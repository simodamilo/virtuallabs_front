<mat-sidenav-container>
  <mat-sidenav mode="side" position="start" opened>
    <h2>Assignment</h2>
    <mat-form-field style="width: 65%;">
      <mat-label>Add assignment</mat-label>
      <input
        matInput
        [(ngModel)]="newAssignment.name"
        placeholder="name" /></mat-form-field
    >&nbsp;&nbsp;&nbsp;
    <mat-form-field style="width: 30%;">
      <mat-label>Deadline</mat-label>
      <input
        matInput
        [(ngModel)]="newAssignment.deadline"
        #date
        [matDatepickerFilter]="myFilter"
        [matDatepicker]="picker"
      />
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
    </mat-form-field>
    <br />
    <input
      #assignmentInput
      type="file"
      (change)="onAssingmentSelected($event)"
    />
    <button mat-button (click)="addAssignment()">
      Add
    </button>
    <br />
    <app-assignments-table
      [assignments]="assignments$"
      (assignmentSelected)="assignmentSelected($event)"
    >
    </app-assignments-table>
  </mat-sidenav>

  <mat-sidenav-content>
    <h2>Solution</h2>
    <div class="mat-elevation-z1" *ngIf="showRevision">
      <h4>
        {{ currentSolutions.student.name }}
        {{ currentSolutions.student.surname }}
        {{ currentSolutions.student.serial }}
      </h4>
      <input
        #solutionInput
        type="file"
        (change)="onSolutionSelected($event)"
      />&nbsp;&nbsp;&nbsp;
      <mat-checkbox
        [checked]="modifiable"
        (change)="changeModifiable()"
        [(ngModel)]="newReview.modifiable"
        color="primary"
        >Modifiable</mat-checkbox
      >&nbsp;&nbsp;&nbsp;
      <mat-form-field *ngIf="!modifiable">
        <mat-label>Grade</mat-label>
        <input matInput placeholder="Grade" [(ngModel)]="newReview.grade" />
      </mat-form-field>
      <br />
      <button mat-button (click)="toggleReview(false)">
        Cancel
      </button>
      <button mat-button (click)="addReview()">
        Add
      </button>
    </div>
    <mat-form-field>
      <mat-label>State filter</mat-label>
      <input
        matInput
        #search
        type="search"
        placeholder="state"
        (keyup)="applyFilter(search.value)"
        [matAutocomplete]="auto"
      />
      <mat-autocomplete #auto (optionSelected)="applyFilter(search.value)">
        <mat-option *ngFor="let option of state" [value]="option">
          {{ option }}
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>

    <div class="mat-elevation-z8">
      <table mat-table matSort [dataSource]="solutionsDataSource">
        <ng-container matColumnDef="student">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            Student
          </th>
          <td mat-cell *matCellDef="let s">
            {{ s.student.name }} {{ s.student.surname }} {{ s.student.serial }}
          </td>
        </ng-container>

        <ng-container matColumnDef="state">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>State</th>
          <td mat-cell *matCellDef="let s">{{ s.state }}</td>
        </ng-container>

        <ng-container matColumnDef="deliveryTs">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            Delivered
          </th>
          <td mat-cell *matCellDef="let s">
            
            {{ formatDate(s.deliveryTs) }}
          </td>
        </ng-container>

        <ng-container matColumnDef="modifiable">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            Modifiable
          </th>
          <td mat-cell *matCellDef="let s">{{ s.modifiable }}</td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let s">
            <button mat-button (click)="loadHistory(s)">
              <mat-icon color="primary">history</mat-icon>
            </button>
            <button
              *ngIf="s.state == 'DELIVERED' || s.state == 'REVIEWED'"
              mat-button
              (click)="viewContent(s)"
            >
              <mat-icon color="primary">visibility</mat-icon>
            </button>
            <button
              *ngIf="s.state == 'DELIVERED'"
              mat-button
              (click)="toggleReview(true, s)"
            >
              <mat-icon color="primary">edit</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="solutionsCols"></tr>
        <tr mat-row *matRowDef="let row; columns: solutionsCols"></tr>
      </table>
      <mat-paginator
        #solutionPag
        [pageSizeOptions]="[5, 10, 20]"
        showFirstLastButtons
      ></mat-paginator>
    </div>
    <br />
    <div *ngIf="isHistoryVisible">
      <h2>
        {{ currentSolutions.student.name }}
        {{ currentSolutions.student.surname }}
        {{ currentSolutions.student.serial }}
      </h2>
      <app-solutions-table [solutions]="history$"> </app-solutions-table>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
